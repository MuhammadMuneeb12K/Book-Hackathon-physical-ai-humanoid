"use strict";(globalThis.webpackChunkhumanoid_robotics_book=globalThis.webpackChunkhumanoid_robotics_book||[]).push([[687],{1425:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"module-1/building-python-nodes","title":"1.2 Building Python Nodes with rclpy","description":"Following our exploration of ROS 2\'s foundational architecture, this chapter shifts focus to practical implementation. We will learn how to develop functional ROS 2 nodes using rclpy, the Python client library for ROS 2. Building custom nodes is essential for extending robotic capabilities, integrating new sensors, and implementing control algorithms.","source":"@site/docs/module-1/02-building-python-nodes.mdx","sourceDirName":"module-1","slug":"/module-1/building-python-nodes","permalink":"/module-1/building-python-nodes","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"building-python-nodes","title":"1.2 Building Python Nodes with rclpy"},"sidebar":"defaultSidebar","previous":{"title":"1.1 ROS 2 Architecture & DDS - The Robotic Nervous System","permalink":"/module-1/ros2-architecture"},"next":{"title":"1.3 URDF for Humanoid Robots","permalink":"/module-1/urdf-humanoid-robots"}}');var r=s(4848),o=s(8453);const l={id:"building-python-nodes",title:"1.2 Building Python Nodes with rclpy"},t=void 0,c={},d=[{value:"Goal",id:"goal",level:2},{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Key Concepts",id:"key-concepts",level:2},{value:"Tools",id:"tools",level:2},{value:"Chapter Sections",id:"chapter-sections",level:2},{value:"1.2.1 Anatomy of a ROS 2 Python Package",id:"121-anatomy-of-a-ros-2-python-package",level:3},{value:"1.2.2 Creating Your First ROS 2 Python Node",id:"122-creating-your-first-ros-2-python-node",level:3},{value:"1.2.3 Implementing Publishers and Subscribers",id:"123-implementing-publishers-and-subscribers",level:3},{value:"1.2.4 Implementing Services",id:"124-implementing-services",level:3},{value:"1.2.5 Building and Running Your Python Package",id:"125-building-and-running-your-python-package",level:3},{value:"Expected Output",id:"expected-output",level:2},{value:"Assessment Questions",id:"assessment-questions",level:2},{value:"Real-world Applications",id:"real-world-applications",level:2},{value:"Edge Cases",id:"edge-cases",level:2},{value:"<strong>Key Entities</strong>",id:"key-entities",level:3},{value:"<strong>References</strong>",id:"references",level:3}];function a(e){const n={code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Following our exploration of ROS 2's foundational architecture, this chapter shifts focus to practical implementation. We will learn how to develop functional ROS 2 nodes using ",(0,r.jsx)(n.code,{children:"rclpy"}),", the Python client library for ROS 2. Building custom nodes is essential for extending robotic capabilities, integrating new sensors, and implementing control algorithms."]}),"\n",(0,r.jsx)(n.h2,{id:"goal",children:"Goal"}),"\n",(0,r.jsxs)(n.p,{children:["The goal of this chapter is to teach students how to build ROS 2 Python nodes using ",(0,r.jsx)(n.code,{children:"rclpy"})," to create functional components for humanoid robot control and data processing."]}),"\n",(0,r.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Understand the structure of a basic ROS 2 Python node."}),"\n",(0,r.jsxs)(n.li,{children:["Learn to create and initialize a ROS 2 node using ",(0,r.jsx)(n.code,{children:"rclpy"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Implement publishers to send messages over ROS 2 topics."}),"\n",(0,r.jsx)(n.li,{children:"Implement subscribers to receive and process messages from ROS 2 topics."}),"\n",(0,r.jsx)(n.li,{children:"Create simple ROS 2 services to handle request-reply communication."}),"\n",(0,r.jsx)(n.li,{children:"Learn how to compile and run ROS 2 Python packages."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'A functional ROS 2 Humble installation (as covered in the "Getting Started" section).'}),"\n",(0,r.jsx)(n.li,{children:"Basic to intermediate proficiency in Python programming."}),"\n",(0,r.jsx)(n.li,{children:"Familiarity with the ROS 2 communication concepts (nodes, topics, services) from the previous chapter."}),"\n",(0,r.jsx)(n.li,{children:"Understanding of standard Python project structure (modules, packages)."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"key-concepts",children:"Key Concepts"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"rclpy"}),":"]})," The Python client library for ROS 2."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"Node"})," class:"]})," The base class for all ROS 2 Python nodes, providing core ROS 2 functionalities."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Publisher:"})," An object in a node responsible for sending messages on a topic."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Subscriber:"})," An object in a node responsible for receiving messages from a topic."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Service Server:"})," An object in a node that provides a service, responding to requests."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Service Client:"})," An object in a node that sends requests to a service server."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Message Types:"})," Predefined data structures for topics, defined in ",(0,r.jsx)(n.code,{children:".msg"})," files."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Service Types:"})," Predefined request-response structures for services, defined in ",(0,r.jsx)(n.code,{children:".srv"})," files."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"setup.py"}),":"]})," Standard Python script for building and installing packages."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"package.xml"}),":"]})," ROS 2 manifest file describing a package's metadata and dependencies."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"tools",children:"Tools"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ROS 2 Humble:"})," The robotic framework."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Python 3:"})," The programming language."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"colcon build"}),":"]})," The ROS 2 build system."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"ros2 run"}),":"]})," Command-line tool to execute ROS 2 nodes."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Code Editor:"})," Visual Studio Code (recommended)."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"chapter-sections",children:"Chapter Sections"}),"\n",(0,r.jsx)(n.h3,{id:"121-anatomy-of-a-ros-2-python-package",children:"1.2.1 Anatomy of a ROS 2 Python Package"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Workspace Structure:"})," Understanding ",(0,r.jsx)(n.code,{children:"colcon"})," workspaces."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"package.xml"}),":"]})," Declaring dependencies and metadata."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"setup.py"}),":"]})," Defining entry points and package installation."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Directory Layout:"})," ",(0,r.jsx)(n.code,{children:"src"}),", ",(0,r.jsx)(n.code,{children:"resource"}),", ",(0,r.jsx)(n.code,{children:"test"})," folders."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"122-creating-your-first-ros-2-python-node",children:"1.2.2 Creating Your First ROS 2 Python Node"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Initialization:"})," Importing ",(0,r.jsx)(n.code,{children:"rclpy"})," and initializing the ROS 2 client library."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Node Creation:"})," Instantiating the ",(0,r.jsx)(n.code,{children:"Node"})," class."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Spinning the Node:"})," Keeping the node alive and processing callbacks."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Shutting Down:"})," Proper ROS 2 shutdown procedures."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"123-implementing-publishers-and-subscribers",children:"1.2.3 Implementing Publishers and Subscribers"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Defining Custom Message Types (Briefly):"})," How to use existing message types and a glance at custom ones."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Creating a Publisher:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.create_publisher(msg_type, topic_name, qos_profile)"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Publishing data in a loop with timers."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Creating a Subscriber:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.create_subscription(msg_type, topic_name, callback_function, qos_profile)"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Processing incoming messages in a callback."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Example: IMU Data Publisher and Subscriber:"})," A practical example demonstrating sensor data flow."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"124-implementing-services",children:"1.2.4 Implementing Services"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Defining Custom Service Types (Briefly):"})," Using existing service types."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Creating a Service Server:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.create_service(srv_type, service_name, callback_function)"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Handling requests and sending responses in a callback."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Creating a Service Client:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"client.call_async(request)"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Sending requests and processing future responses."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Example: Joint Command Service:"})," A service to set a specific joint angle for a robot."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"125-building-and-running-your-python-package",children:"1.2.5 Building and Running Your Python Package"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Building with ",(0,r.jsx)(n.code,{children:"colcon build"}),":"]})," Compiling your ROS 2 Python package."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Running Nodes:"})," Using ",(0,r.jsx)(n.code,{children:"ros2 run <package_name> <executable_name>"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Debugging Tips:"})," Common errors and how to troubleshoot."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"expected-output",children:"Expected Output"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A functional ROS 2 Python package containing publisher and subscriber nodes."}),"\n",(0,r.jsxs)(n.li,{children:["Ability to create custom ROS 2 nodes using ",(0,r.jsx)(n.code,{children:"rclpy"})," to interact with topics."]}),"\n",(0,r.jsxs)(n.li,{children:["Understanding of the ",(0,r.jsx)(n.code,{children:"colcon"})," build system for Python packages."]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"imu_subscriber"})," node successfully processes IMU data."]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"joint_publisher"})," node successfully publishes joint commands."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"assessment-questions",children:"Assessment Questions"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Describe the essential steps to create a new ROS 2 Python package."}),"\n",(0,r.jsxs)(n.li,{children:["What is the role of ",(0,r.jsx)(n.code,{children:"rclpy.spin()"})," in a ROS 2 Python node?"]}),"\n",(0,r.jsxs)(n.li,{children:["How would you modify the ",(0,r.jsx)(n.code,{children:"ImuSubscriber"})," to filter out IMU messages based on a specific ",(0,r.jsx)(n.code,{children:"frame_id"}),"?"]}),"\n",(0,r.jsxs)(n.li,{children:["Explain the purpose of ",(0,r.jsx)(n.code,{children:"setup.py"})," and ",(0,r.jsx)(n.code,{children:"package.xml"})," in a ROS 2 Python package."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"real-world-applications",children:"Real-world Applications"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Sensor Data Acquisition:"})," Writing nodes to interface with new hardware sensors (e.g., custom LiDAR, camera, force/torque sensors) and publish their data to ROS 2 topics."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Low-Level Actuator Control:"})," Developing nodes that translate high-level commands into specific joint positions, velocities, or efforts for robot motors."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Algorithm Integration:"})," Implementing novel control algorithms, state estimators, or perception routines as ROS 2 nodes to process data and generate commands."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Humanoid Gait Generation:"})," A node publishing a sequence of joint commands to execute a walking or balancing gait."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"edge-cases",children:"Edge Cases"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Callback Queue Overload:"})," If a subscriber's callback takes too long to process messages, the queue can build up, leading to latency or dropped messages."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Incorrect Message Types:"})," Publishing or subscribing with an incorrect message type will lead to communication errors."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Missing Dependencies:"})," Not declaring all Python or ROS 2 dependencies in ",(0,r.jsx)(n.code,{children:"package.xml"})," and ",(0,r.jsx)(n.code,{children:"setup.py"})," can cause runtime failures."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Node Crashes:"})," Unhandled exceptions in node callbacks can crash the node, interrupting the robotic system."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"key-entities",children:(0,r.jsx)(n.strong,{children:"Key Entities"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"rclpy"}),":"]})," The primary Python library for interfacing with the ROS 2 framework."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"Node"}),":"]})," The fundamental building block in ROS 2, representing an executable process that can communicate with other nodes."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"Publisher"}),":"]})," An ",(0,r.jsx)(n.code,{children:"rclpy"})," object within a node responsible for sending messages on a specific topic."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"Subscriber"}),":"]})," An ",(0,r.jsx)(n.code,{children:"rclpy"})," object within a node responsible for receiving messages from a specific topic and processing them via a callback function."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"JointState"}),":"]})," A standard ROS 2 message type (",(0,r.jsx)(n.code,{children:"sensor_msgs/msg/JointState"}),") used to convey the position, velocity, and effort of a robot's joints."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"Imu"}),":"]})," A standard ROS 2 message type (",(0,r.jsx)(n.code,{children:"sensor_msgs/msg/Imu"}),") used to convey inertial measurement unit data (orientation, angular velocity, linear acceleration)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"colcon build"}),":"]})," The standard build tool for ROS 2 packages, compiling source code and installing executables and libraries."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"setup.py"}),":"]})," A Python script used by ",(0,r.jsx)(n.code,{children:"setuptools"})," to define how a Python package is built and distributed, including console script entry points for ROS 2 nodes."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"references",children:(0,r.jsx)(n.strong,{children:"References"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Open Robotics. (2022). ",(0,r.jsx)(n.em,{children:"ROS 2 Documentation: Writing a Python Publisher and Subscriber (rclpy)"}),". (Placeholder citation)"]}),"\n",(0,r.jsxs)(n.li,{children:["Open Robotics. (2022). ",(0,r.jsx)(n.em,{children:"ROS 2 Documentation: Writing a Python Service and Client (rclpy)"}),". (Placeholder citation)"]}),"\n",(0,r.jsxs)(n.li,{children:["Python Software Foundation. (2023). ",(0,r.jsx)(n.em,{children:"Python 3 Documentation"}),". (Placeholder citation)"]}),"\n",(0,r.jsxs)(n.li,{children:["Mesa, L., & Rojas, A. (2020). Modern C++ and Python Programming for ROS 2. ",(0,r.jsx)(n.em,{children:"Packt Publishing"}),". (Placeholder citation)"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>t});var i=s(6540);const r={},o=i.createContext(r);function l(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);