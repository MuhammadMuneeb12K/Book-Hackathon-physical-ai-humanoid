---
id: ros2-architecture
title: 1.1 ROS 2 Architecture & DDS - The Robotic Nervous System
---
Welcome to Module 1: The Robotic Nervous System (ROS 2). In this chapter, we delve into the fundamental architecture of ROS 2, understanding how it forms the communication backbone for complex robotic systems, especially humanoid robots. We will explore the core concepts of the Data Distribution Service (DDS) and how it facilitates real-time, decentralized communication between various components.

## Goal

The goal of this chapter is to teach students how ROS 2 enables humanoid robot control through its underlying communication architecture, including nodes, topics, and services, with a deep understanding of DDS.

## Learning Objectives

*   Understand the fundamental principles of the ROS 2 communication architecture, including DDS, nodes, topics, and services.
*   Differentiate between the various communication patterns in ROS 2.
*   Grasp how DDS ensures real-time and robust inter-process communication in a distributed robotic system.
*   Identify the key components of the ROS Graph and their interactions.

## Prerequisites

*   Basic understanding of Linux command-line operations.
*   Familiarity with fundamental computer networking concepts (e.g., client-server, publish-subscribe).
*   Basic understanding of robotics concepts (e.g., sensors, actuators).

## Key Concepts

*   **ROS Graph:** The computational graph of ROS 2, representing the network of communicating processes.
*   **Node:** An executable process in ROS 2 that performs computation (e.g., sensor driver, controller, algorithm).
*   **Topic:** A named bus over which nodes exchange messages using a publish-subscribe communication model.
*   **Message:** Data structure used for communication over topics.
*   **Publisher:** A node that sends messages to a topic.
*   **Subscriber:** A node that receives messages from a topic.
*   **Service:** A request/reply communication mechanism between nodes, suitable for synchronous operations.
*   **Action:** A long-running, goal-oriented communication pattern, ideal for tasks with intermediate feedback and cancellability.
*   **Data Distribution Service (DDS):** The middleware layer that ROS 2 uses for discovery, serialization, and transport of data.
*   **Quality of Service (QoS) Policies:** Settings in DDS that define how data is transferred (e.g., reliability, durability, history).

## Tools

*   **ROS 2 Humble:** The specific distribution of ROS 2 we will be using.
*   **`ros2` command-line tools:** For interacting with the ROS Graph (e.g., `ros2 node`, `ros2 topic`).
*   **`rqt_graph`:** A graphical tool for visualizing the ROS 2 computational graph.

## Chapter Sections

### 1.1.1 Introduction to ROS 2 and its Philosophy

*   Brief history and evolution from ROS 1 to ROS 2.
*   Key motivations for ROS 2: real-time capabilities, security, and multi-robot support.
*   The concept of a distributed system in robotics.

### 1.1.2 The ROS Graph: Nodes, Topics, and Messages

*   **What is a Node?** The fundamental unit of computation.
*   **Topics: Publish-Subscribe Communication:**
    *   How publishers send data and subscribers receive it.
    *   Message types and their structure.
    *   Example: A temperature sensor publishing data, a display node subscribing to it.
*   **Services: Request-Reply Communication:**
    *   When to use services versus topics.
    *   Defining service types and their request/response structure.
    *   Example: A robot arm moving to a specific joint angle and returning success.
*   **Actions: Long-running Goal-Oriented Tasks:**
    *   The structure of an action: Goal, Feedback, Result.
    *   Use cases for actions in humanoid control (e.g., walking to a destination).

### 1.1.3 Data Distribution Service (DDS): The Middleware Powering ROS 2

*   **DDS as the Backbone:** How DDS handles discovery, serialization, and transport.
*   **Decentralized Communication:** No central master, direct node-to-node communication.
*   **Quality of Service (QoS) Policies:**
    *   **Reliability:** Guaranteed delivery vs. best-effort.
    *   **Durability:** Latching last message vs. transient local.
    *   **History:** Keep all vs. keep last N.
    *   Impact of QoS on real-time performance and data integrity.
*   Common DDS implementations (e.g., Fast DDS, Cyclone DDS).

### 1.1.4 Visualizing the ROS Graph with `rqt_graph`

*   Using `rqt_graph` to inspect running ROS 2 systems.
*   Understanding node-topic connections visually.

## Required Diagrams

*   **ROS Graph Architecture:** A diagram illustrating multiple nodes communicating via topics and services.
*   **Node Publisher/Subscriber Flow:** A detailed diagram showing data flow from a publisher node to a subscriber node over a topic.
*   **DDS Communication Layers:** A conceptual diagram showing how DDS acts as the middleware layer for ROS 2 communication.

## Hands-on Labs

### Lab 1.1.1: Exploring the ROS 2 Graph
1.  **Objective:** Launch basic ROS 2 nodes and visualize their interconnections using `rqt_graph`.
2.  **Instructions:**
    *   Open a terminal and source your ROS 2 environment: `source /opt/ros/humble/setup.bash`.
    *   Start a `talker` node: `ros2 run demo_nodes_cpp talker`.
    *   Open a *second* terminal, source ROS 2, and start a `listener` node: `ros2 run demo_nodes_py listener`.
    *   Open a *third* terminal, source ROS 2, and launch `rqt_graph`: `rqt_graph`.
    *   Observe the `talker` and `listener` nodes and their connection via the `/topic` topic in the `rqt_graph` window. Experiment with toggling options in `rqt_graph` to filter nodes or topics.
    *   Use `ros2 node list`, `ros2 topic list`, `ros2 service list` to inspect the running graph from the command line.

### Lab 1.1.2: Understanding QoS Policies
1.  **Objective:** Observe the effect of different QoS policies on message transmission using the `ros2 topic echo` and `ros2 topic pub` commands.
2.  **Instructions:**
    *   Open a terminal and source your ROS 2 environment.
    *   Start echoing a topic with default QoS: `ros2 topic echo /my_test_topic`.
    *   Open a *second* terminal, source ROS 2, and publish a few messages to the topic: `ros2 topic pub /my_test_topic std_msgs/msg/String "data: 'Hello 1'" --once`. Repeat with "Hello 2", "Hello 3".
    *   Observe if all messages are received by the echo.
    *   Now, in the *first* terminal, *restart* the `ros2 topic echo` but add a `history` QoS policy for durability: `ros2 topic echo /my_test_topic --qos-history keep_all --qos-durability transient_local`.
    *   In the *second* terminal, publish another message: `ros2 topic pub /my_test_topic std_msgs/msg/String "data: 'Hello Durable'" --once`.
    *   Then *stop and restart* the `ros2 topic echo` in the *first* terminal with the same QoS. Observe if it receives the "Hello Durable" message even if it wasn't running when published. Discuss why this happens.

## Expected Output

*   A clear understanding of the ROS 2 communication paradigms (topics, services, actions).
*   Ability to use `ros2` command-line tools to inspect the ROS Graph.
*   Ability to interpret `rqt_graph` visualizations.
*   Familiarity with the concept and practical impact of DDS QoS policies.

## Assessment Questions

*   Explain the primary difference between ROS 2 topics and services, and provide a scenario where each would be most appropriate for humanoid robot control.
*   How does DDS contribute to the real-time capabilities and fault tolerance of ROS 2 systems?
*   Describe at least two QoS policies and explain how they can influence data delivery in a ROS 2 application.
*   If you see two nodes not communicating even though they are publishing/subscribing to the same topic, what could be a potential reason related to DDS?

## Real-world Applications

*   **Humanoid Limb Control:** High-frequency joint state topics and command topics for controlling individual robot limbs.
*   **Sensor Fusion and Real-time Robotics:** Integrating data from various sensors (IMU, LiDAR, cameras) using topics for state estimation and perception.
*   **Industrial Robotic Arms and Manipulators:** Services for issuing single-shot commands (e.g., "pick up object X"), and actions for complex sequences (e.g., "move to charging station").
*   **Multi-Robot Systems:** Leveraging DDS's distributed nature for coordination and communication between multiple humanoid robots or robot components.

## Edge Cases

*   **Network Latency:** High latency in the network can affect real-time performance, especially for critical control loops.
*   **QoS Mismatches:** If publishers and subscribers have incompatible QoS policies, communication might fail or be unreliable.
*   **Message Type Mismatches:** Nodes attempting to communicate with different message types on the same topic will fail.
*   **DDS Implementation Differences:** Subtle behavioral differences between various DDS vendor implementations could lead to unexpected issues.

---

### **Key Entities**

*   **ROS Graph:** The dynamic network of all executable processes (nodes) in ROS 2 and their interconnections.
*   **Node:** A standalone computational process within ROS 2.
*   **Topic:** A named data bus for asynchronous, many-to-many message passing.
*   **Service:** A named connection for synchronous, one-to-one request-reply interactions.
*   **Action:** A named mechanism for long-running, asynchronous, goal-oriented tasks with feedback.
*   **DDS (Data Distribution Service):** The underlying data-centric middleware that enables robust, real-time, and efficient data exchange in ROS 2.
*   **QoS Policies (Quality of Service Policies):** A set of configurable parameters that define the behavior of DDS communication channels.

---

### **References**

*   Gerkey, B., & Konolige, K. (2010). *ROS: The Robot Operating System*. O'Reilly Media. (Placeholder citation)
*   Pardo-Castellote, G. (2009). The OMG Data Distribution Service. *IEEE Computer, 42*(12), 105-107. (Placeholder citation)
*   Open Robotics. (2022). *ROS 2 Documentation: Concepts*. (Placeholder citation)
*   Macenski, S., et al. (2021). The ROS 2 Navigation Stack: From Birth to Fledgling. *Journal of Open Source Software, 6*(62), 3390. (Placeholder citation)
